<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create New Voting - VoteLedger</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .voting-form-box {
            background: #222;
            border-radius: 18px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.10);
            padding: 2.5rem 1.5rem 2rem 1.5rem;
            margin: 2rem auto 2.5rem auto;
            max-width: 1100px;
        }
    </style>
</head>
<body class="bg-black">
    <!-- Home Button -->
    <!-- Remove the top-left Home button -->
    <!-- Navigation (same as home.html) -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-black ">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-vote-yea me-2"></i>VoteLedger
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="ms-auto">
                    <button class="btn btn-warning btn-connect-wallet" id="connectWalletBtn">Connect Wallet</button>
                </div>
            </div>
        </div>
    </nav>
    <div class="navbar-separator"></div>

    <div class="container">
        <div class="voting-form-box">
            <h2 class="hero-title mb-3">Create New Voting Session</h2>
            <form id="createVotingForm">
                <div class="mb-3">
                    <label for="sessionId" class="form-label text-light">Session ID</label>
                    <input type="text" class="form-control" id="sessionId" required>
                </div>
                <div class="mb-3">
                    <label for="endDate" class="form-label text-light">End Date & Time</label>
                    <input type="datetime-local" class="form-control" id="endDate" required>
                </div>
                <div class="mb-3">
                    <label class="form-label text-light">Candidate Names</label>
                    <div id="candidatesList">
                        <input type="text" class="form-control mb-2 candidate-input" placeholder="Candidate Name" required>
                    </div>
                    <button type="button" class="btn btn-sm btn-secondary" id="addCandidateBtn">Add Another Candidate</button>
                </div>
                <button type="submit" class="btn btn-warning btn-create-voting">Create Voting</button>
            </form>
            <div id="votingStatus" class="mt-3" style="min-height:2.5rem;"></div>
        </div>
        <div class="home-btn-center home-btn-gap">
            <a href="home.html" class="btn btn-warning btn-create-voting">Home</a>
        </div>
    </div>
    <div class="footer-separator"></div>
    <!-- Footer (same as home.html) -->
    <footer class="bg-black text-light pt-5 pb-4">
        <div class="container text-md-left">
          <div class="row text-md-left">
              <!-- Company Info -->
              <div class="col-md-4 col-lg-4 col-xl-4 mx-auto mt-3">
                <h5 class="text-uppercase text-warning mb-4 font-weight-bold">VoteLedger</h5>
                <p >
                  Your voice matters. VoteLeder empowers digital democracy through secure, easy-to-use voting technology.
                </p>
              </div>
              <!-- Useful Links -->
              <div class="col-md-3 col-lg-3 col-xl-3 mx-auto mt-3">
                <h5 class="text-uppercase text-warning mb-4">Quick Links</h5>
                <p><a href="index.html" class="text-light text-decoration-none">Home</a></p>
                <p><a href="login.html" class="text-light text-decoration-none">Login</a></p>
                <p><a href="vote.html" class="text-light text-decoration-none">Vote Now</a></p>
                <p><a href="tel:+919876543210" class="text-light text-decoration-none">Contact</a></p>
              </div>
              <!-- Contact Info -->
              <div class="col-md-4 col-lg-4 col-xl-4 mx-auto mt-3">
                <h5 class="text-uppercase text-warning mb-4">Contact</h5>
                <p class="text-light"><i class="bi bi-envelope me-2"></i> ak9754886@gmail.com</p>
                <p class="text-light"><i class="bi bi-telephone me-2"></i> +91 9873134920</p>
                <p class="text-light"><i class="bi bi-geo-alt me-2"></i> Delhi, India</p>
              </div>
          </div>
          <hr class="text-white my-4">
          <!-- Social & Copyright -->
          <div class="row align-items-center ">
            <div class="col-md-7 col-lg-8">
              <p class="text-muted mb-0">Â© 2025 VoteLedger. All rights reserved.</p>
            </div>
            <div class="col-md-5 col-lg-4 text-md-end">
              <a href="#" class="text-muted me-3"><i class="https://x.com/Anupam_3792"></i></a>
              <a href="#" class="text-muted me-3"><i class="https://github.com/Anupam3792"></i></a>
              <a href="#" class="text-muted me-3"><i class="bi bi-instagram fs-5"></i></a>
              <a href="#" class="text-muted"><i class="https://www.linkedin.com/in/anupam-kumar-4b6b94261?utm_source=share&utm_campaign=share_via&utm_content=profile&utm_medium=android_app"></i></a>
            </div>
          </div>
        </div>
      </footer>

    <!-- Bootstrap Icons CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Web3.js -->
    <script src="https://cdn.jsdelivr.net/npm/web3@1.5.2/dist/web3.min.js"></script>
    <!-- ethers.js -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <!-- Custom JS -->
    <script src="app.js"></script>
    <script>
    function shortAddress(addr) {
        return addr ? addr.slice(0, 6) + '...' + addr.slice(-4) : '';
    }
    document.getElementById('connectWalletBtn').onclick = async function() {
        if (window.ethereum) {
            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                const shortAddr = shortAddress(accounts[0]);
                this.textContent = shortAddr;
                this.classList.remove('btn-warning');
                this.classList.add('btn-success');
                this.disabled = false;
            } catch (e) {
                alert('Wallet connection failed.');
            }
        } else {
            alert('MetaMask not found!');
        }
    };
    document.getElementById('addCandidateBtn').onclick = function() {
        const list = document.getElementById('candidatesList');
        const input = document.createElement('input');
        input.type = 'text';
        input.className = 'form-control mb-2 candidate-input';
        input.placeholder = 'Candidate Name';
        input.required = true;
        list.appendChild(input);
    };
    document.getElementById('createVotingForm').onsubmit = async function(e) {
        e.preventDefault();
        const status = document.getElementById('votingStatus');
        status.innerHTML = '';
        if (!window.ethereum) {
            status.innerHTML = '<div class="alert alert-danger">MetaMask is required.</div>';
            return;
        }
        const sessionId = document.getElementById('sessionId').value.trim();
        const endDate = document.getElementById('endDate').value;
        const candidateInputs = document.querySelectorAll('.candidate-input');
        const candidateNames = Array.from(candidateInputs).map(i => i.value.trim()).filter(Boolean);
        if (!sessionId || !endDate || candidateNames.length < 2) {
            status.innerHTML = '<div class="alert alert-warning">Please fill all fields and add at least 2 candidates.</div>';
            return;
        }
        const unixEnd = Math.floor(new Date(endDate).getTime() / 1000);
        try {
            const provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send('eth_requestAccounts', []);
            const signer = provider.getSigner();
            const contract = new ethers.Contract(contractAddress, contractABI, signer);
            status.innerHTML = '<div class="alert alert-info">Transaction sent. Waiting for confirmation...</div>';
            const tx = await contract.createSession(sessionId, unixEnd, candidateNames);
            status.innerHTML = '<div class="alert alert-info">Transaction sent. Waiting for confirmation...</div>';
            await tx.wait();
            status.innerHTML = '<div class="alert alert-success">Voting session created successfully!</div>';
            this.reset();
        } catch (err) {
            status.innerHTML = '<div class="alert alert-danger">Error: ' + (err?.reason || err?.message || 'Unknown error') + '</div>';
            console.error(err);
        }
    };
    </script>
</body>
</html> 